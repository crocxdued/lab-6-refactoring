# Lab 6: Refactoring and Clean Code (Python)

Данная работа посвящена рефакторингу существующего кода обработки заказов (`order_processing.py`). Основная цель — устранение «запахов кода» (code smells), улучшение читаемости и приведение структуры в соответствие с принципами Clean Code.

**Репозиторий:** lab6-refactoring-michailov  
**Спринт:** Sprint 1: Code Quality Improvement

---

## 1. Найденные проблемы качества (Code Smells)

В исходном коде были выявлены следующие проблемы:
* **Long Method (Длинный метод):** Функция `process_checkout` выполняла слишком много задач одновременно (валидация, расчеты, парсинг, форматирование).
* **Magic Numbers (Магические числа):** Налоговые ставки (0.21) и коэффициенты скидок (0.1, 0.2, 0.05) были жестко прописаны в коде без объяснения их смысла.
* **Deep Nesting (Глубокая вложенность):** Большое количество вложенных условий `if-elif-else`, что затрудняло понимание логики купонов.
* **Lack of Type Hinting:** Отсутствие аннотаций типов затрудняло поддержку кода и увеличивало риск ошибок при передаче данных.
* **Poor Decomposition:** Логика валидации входных данных была смешана с бизнес-логикой расчетов.

---

## 2. Примененные рефакторинги

Для улучшения кода были использованы следующие техники:
1.  **Extract Method (Извлечение метода):** Основная функция разбита на вспомогательные: `validate_items`, `calculate_subtotal`, `get_coupon_discount`.
2.  **Replace Magic Number with Symbolic Constant:** Все числовые коэффициенты вынесены в именованные константы (например, `TAX_RATE`, `SAVE10_RATE`).
3.  **Replace Nested Conditional with Guard Clauses:** Валидация вынесена в начало функций, что позволило избавиться от лишних уровней вложенности.
4.  **Introduce Type Hinting:** Добавлены аннотации типов для всех аргументов и возвращаемых значений функций.
5.  **Rename Variables:** Переменные переименованы в соответствии с PEP 8 (например, `it` -> `item`, `res` -> `total_price`).



---

## 3. Результаты: что стало проще

После проведения рефакторинга:
* **Читаемость:** Логика каждой части (валидация, скидки, налоги) теперь изолирована. По названию функций сразу понятно, что они делают.
* **Тестируемость:** Теперь можно писать модульные тесты отдельно для логики купонов или валидации, не вызывая весь процесс оформления заказа.
* **Масштабируемость:** Добавление нового типа купона теперь требует изменения только одной функции (`get_coupon_discount`), а не переписывания всей логики заказа.
* **Надежность:** Благодаря типизации и выносу валидации, ошибки во входных данных отлавливаются на ранних этапах.

---

## 4. Sprint Review & Retrospective

### Sprint Review
* **Выполнено:** Все 6 задач бэклога по рефакторингу закрыты. 
* **Результат:** Тесты в `test_order_processing.py` проходят успешно (100% success rate), функциональность сохранена полностью.

### Sprint Retrospective
* **Что прошло хорошо:** Удалось значительно сократить цикломатическую сложность кода. Использование GitHub Issues помогло структурировать этапы рефакторинга.
* **Что улучшить:** В следующий раз стоит добавить автоматическую проверку линтером (flake8) в GitHub Actions.
